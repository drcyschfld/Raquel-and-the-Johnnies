/*
 * digital_io_interface.c
 *
 *  Created on: May 9, 2024
 *      Author: nataliebrown
 */

/*
 * digital_io_interface.c
 *
 *  Created on: Apr 8, 2024
 *      Author: nataliebrown
 *
 */
#include "digital_io_interface.h"

void (*on_button_press)() = 0x00;

void set_state(uint16_t state) {
	//update the led state by changing the upper 8 bits of the GPIOE ODR pin
	GPIOE->ODR = (GPIOE->ODR & 0x00FF) | (state << 8);

}

uint8_t get_state(void){
	// return the state of the led state from the GPIOE ODR pin
	return (GPIOE->ODR >> 8) & 0x00FF;
}

void EXTI0_IRQHandler(void) {
	//if the button is pressed, call on_button_pressed
    if (on_button_press != 0x00) {
    	on_button_press();
    }

    EXTI->PR |= EXTI_PR_PR0;
}

void button_initialise(void (*fp)(void)) {
	on_button_press = fp; // fp is a function pointer
}

void chase_led() {

	//retrieve current state
	uint8_t led_register = get_state();

	//apply led logic
			led_register <<= 1;
			if (led_register == 0) {
				led_register = 1;
			}
			//update state
			set_state(led_register);

}









